---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import QuickEstimateCard from "../../../components/QuickEstimateCard.astro";
import PageCtaStrip from "../../../components/PageCtaStrip.astro";
import { services } from "../../../data/services";
import { serviceAreas } from "../../../data/service-areas";
import { cityContent } from "../../../data/city-content";
import { getBreadcrumbJsonLd, getLocalBusinessJsonLd } from "../../../lib/seo";

export function getStaticPaths() {
  return serviceAreas.map((area) => ({
    params: { city: area.slug },
    props: { city: area },
  }));
}

const { city } = Astro.props;

const content = cityContent[city.slug] ?? {};

const intro =
  content.intro ??
  `Local handyman services for homeowners in ${city.label} and nearby neighborhoods. Typical visits combine several small repair or improvement tasks into a tidy service window.`;

const neighborhoods = content.neighborhoods ?? [];
const propertyTypes = content.propertyTypes ?? [];
const popularProjects = content.popularProjects ?? [];

const landlordNote =
  content.landlordNote ??
  "Helpful for small rental portfolios that need occasional drywall repairs, fixture swaps, or honey-do style lists between longer tenancies.";

const businessNote =
  content.businessNote ??
  "Light repairs and small improvement projects for local offices, studios, and storefronts that want a tidy result with minimal disruption.";

const reviewSnippet = content.reviewSnippet ?? {
  quote:
    "They handled drywall repairs, a few trim fixes, and a new light in one visit. Everything looked neat and was cleaned up before they left.",
  name: "Sarah M.",
  location: `${city.label}, CA`,
  role: "Homeowner",
};

const servicesTitle = `Handyman services available in ${city.label}`;
const coverageTitle = `A local option for small home projects in ${city.label}, CA`;

const breadcrumbJsonLd = JSON.stringify(
  getBreadcrumbJsonLd([
    { name: "Home", url: "/" },
    { name: "Service areas", url: "/service-areas/" },
    { name: city.label, url: `/service-areas/${city.slug}/` },
  ]),
);

const localBusinessJsonLd = JSON.stringify(
  getLocalBusinessJsonLd([city.label]),
);

const title = `Handyman services in ${city.label} | Carlsbad Fix It`;
const description = `Local handyman help for small to medium projects in ${city.label} and nearby North County San Diego communities. Combine several tasks into a single, tidy visit with Carlsbad Fix It.`;
---

<BaseLayout title={title} description={description}>
  <script
    type="application/ld+json"
    slot="head"
    is:inline
    set:html={localBusinessJsonLd}
  />
  <script
    type="application/ld+json"
    slot="head"
    is:inline
    set:html={breadcrumbJsonLd}
  />

  <section class="shadow-card rounded-3xl bg-white p-6 md:p-8">
    <div
      class="grid gap-10 lg:grid-cols-[minmax(0,1.5fr)_minmax(0,1.2fr)] lg:items-center"
    >
      <div class="space-y-5">
        <div class="space-y-2">
          <p class="eyebrow text-cf-textMuted">Service area</p>
          <h1 class="text-display text-cf-text font-semibold tracking-tight">
            Handyman services in {city.label}
          </h1>
          <p class="text-body-sm text-cf-textMuted max-w-xl">
            {intro}
          </p>
        </div>

        <ul
          class="text-cf-text grid gap-3 text-sm sm:grid-cols-2 md:gap-4 md:text-base"
        >
          <li class="flex gap-2">
            <span
              class="bg-cf-sandSoft text-cf-primary mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full text-[11px] font-semibold"
            >
              ✓
            </span>
            <span
              >Licensed and insured local handyman serving {city.label} and nearby
              North County communities.</span
            >
          </li>
          <li class="flex gap-2">
            <span
              class="bg-cf-sandSoft text-cf-primary mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full text-[11px] font-semibold"
            >
              ✓
            </span>
            <span
              >Focused on small to medium home projects that fit into clear
              service windows.</span
            >
          </li>
          <li class="flex gap-2">
            <span
              class="bg-cf-sandSoft text-cf-primary mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full text-[11px] font-semibold"
            >
              ✓
            </span>
            <span
              >Tidy job sites with surfaces protected and cleanup before
              leaving.</span
            >
          </li>
          <li class="flex gap-2">
            <span
              class="bg-cf-sandSoft text-cf-primary mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full text-[11px] font-semibold"
            >
              ✓
            </span>
            <span
              >Clear expectations on scope, timing, and pricing before work
              begins.</span
            >
          </li>
        </ul>

        <div class="flex flex-wrap items-center gap-3 text-sm">
          <a href="#city-form" class="btn-primary"> Request an estimate </a>
          <a
            href="tel:+18082266681"
            data-ga-event="call_click"
            data-ga-label="site_phone"
            class="border-cf-accentBlueSoft to-cf-accentBlueSoft/40 text-cf-accentBlue shadow-soft hover:to-cf-accentBlueSoft/70 inline-flex items-center justify-center rounded-full border bg-gradient-to-r from-white px-5 py-2 text-sm font-semibold hover:from-white"
          >
            Call or text (808) 226-6681
          </a>
        </div>
      </div>

      <aside
        id="city-form"
        class="bg-cf-sandSoft text-cf-text shadow-cta rounded-2xl p-5 sm:p-6"
      >
        <QuickEstimateCard
          eyebrow="Get your estimate started"
          title={`Request your free estimate in ${city.label}`}
          body={`Tell us about your project in ${city.label}. Share your location, a short list of tasks, and any helpful photos. You will receive clear next steps, timing, and a no-obligation estimate.`}
          defaultCity={city.label}
        />
      </aside>
    </div>
  </section>

  <section class="bg-cf-sandSoft rounded-3xl p-6 md:p-8">
    <div
      class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between"
    >
      <div class="space-y-2">
        <p class="eyebrow text-cf-textMuted">Services in {city.label}</p>
        <h2 class="text-h2 text-cf-text font-semibold">
          {servicesTitle}
        </h2>
        <p class="text-body-sm text-cf-textMuted max-w-2xl">
          Core handyman services focused on the small to medium projects
          homeowners in {city.label} call about most. You can also combine several
          tasks into a single visit.
        </p>
      </div>
    </div>

    <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {
        services.map((service) => (
          <article class="text-cf-text shadow-soft flex h-full flex-col justify-between rounded-2xl bg-white p-5 text-sm">
            <div class="space-y-2">
              <h3 class="text-cf-text text-sm font-semibold">{service.name}</h3>
              <p class="text-cf-textMuted text-xs">
                {service.shortDescription}
              </p>
            </div>
            <div class="mt-4 flex items-center justify-between gap-2 text-[11px]">
              <a
                href={`/service-areas/${city.slug}/${service.slug}/`}
                class="btn-primary h-8 px-4 text-[11px]"
              >
                View {service.name.toLowerCase()}
              </a>
              <span class="text-cf-textMuted">In {city.label}</span>
            </div>
          </article>
        ))
      }
    </div>
  </section>

  <section class="shadow-soft rounded-3xl bg-white p-6 md:p-8">
    <div class="grid gap-8 lg:grid-cols-2 lg:items-start">
      <div class="space-y-3">
        <p class="eyebrow text-cf-textMuted">Coverage</p>
        <h2 class="text-h2 text-cf-text font-semibold">
          {coverageTitle}
        </h2>
        <p class="text-body-sm text-cf-textMuted">
          Most visits in {city.label} are scheduled to keep travel time reasonable
          and maximize time spent on actual repair and improvement work. Projects
          are scoped so they fit into a single visit whenever possible, with larger
          projects broken into clear phases.
        </p>

        {
          neighborhoods.length > 0 && (
            <div class="mt-4">
              <p class="text-cf-textMuted text-xs font-semibold tracking-wide uppercase">
                Neighborhoods often served
              </p>
              <div class="mt-2 flex flex-wrap gap-2 text-[11px]">
                {neighborhoods.map((name) => (
                  <span class="bg-cf-sandSoft text-cf-text inline-flex items-center rounded-full px-3 py-1">
                    {name}
                  </span>
                ))}
              </div>
            </div>
          )
        }

        {
          propertyTypes.length > 0 && (
            <div class="mt-4">
              <p class="text-cf-textMuted text-xs font-semibold tracking-wide uppercase">
                Typical property types
              </p>
              <ul class="text-cf-textMuted mt-2 grid gap-1 text-xs sm:grid-cols-2">
                {propertyTypes.map((type) => (
                  <li class="flex gap-2">
                    <span class="bg-cf-sandSoft text-cf-primary mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full text-[11px] font-semibold">
                      •
                    </span>
                    <span>{type}</span>
                  </li>
                ))}
              </ul>
            </div>
          )
        }
      </div>

      <div class="space-y-4 lg:grid lg:grid-cols-2 lg:items-start lg:gap-4">
        {
          popularProjects.length > 0 && (
            <section class="bg-cf-sandSoft rounded-2xl p-5 lg:col-span-2">
              <p class="text-cf-textMuted text-xs font-semibold tracking-wide uppercase">
                Popular projects in {city.label}
              </p>
              <div class="mt-3 grid gap-3 md:grid-cols-2">
                {popularProjects.map((project) => (
                  <div class="text-cf-text shadow-soft rounded-2xl bg-white p-4 text-xs">
                    <h3 class="text-cf-text text-sm font-semibold">
                      {project.title}
                    </h3>
                    <p class="text-cf-textMuted mt-1 text-xs">
                      {project.summary}
                    </p>
                  </div>
                ))}
              </div>
            </section>
          )
        }

        <section class="bg-cf-sandSoft text-cf-text rounded-2xl p-5 text-xs">
          <p
            class="text-cf-textMuted text-xs font-semibold tracking-wide uppercase"
          >
            For small rentals
          </p>
          <p class="text-cf-textMuted mt-2">
            {landlordNote}
          </p>
        </section>

        <section class="bg-cf-sandSoft text-cf-text rounded-2xl p-5 text-xs">
          <p
            class="text-cf-textMuted text-xs font-semibold tracking-wide uppercase"
          >
            For local businesses
          </p>
          <p class="text-cf-textMuted mt-2">
            {businessNote}
          </p>
        </section>

        <section
          class="bg-cf-card text-cf-text shadow-soft rounded-2xl p-5 text-xs lg:col-span-2"
        >
          <p
            class="text-cf-textMuted text-xs font-semibold tracking-wide uppercase"
          >
            What homeowners say in {city.label}
          </p>
          <p class="text-cf-textMuted mt-2 text-sm">
            “{reviewSnippet.quote}”
          </p>
          <p class="text-cf-textMuted mt-3 text-xs">
            {reviewSnippet.name}
            {reviewSnippet.location ? ` · ${reviewSnippet.location}` : ""}
            {reviewSnippet.role ? ` · ${reviewSnippet.role}` : ""}
          </p>
        </section>
      </div>
    </div>
  </section>

  <PageCtaStrip
    eyebrow={`Next steps in ${city.label}`}
    title={`Ready to schedule a handyman visit in ${city.label}?`}
    body={`Share your punch list, preferred timing, and any helpful photos. You will receive clear next steps and a no-obligation estimate for your home in ${city.label}.`}
  />
</BaseLayout>
