---
import "../styles/global.css";
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";
import TrustStrip from "../components/TrustStrip.astro";
import MobileStickyCta from "../components/MobileStickyCta.astro";

export interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  noIndex?: boolean;
  ogType?: string;
  ogImage?: string;
}

const {
  title = "Carlsbad Fix It | Handyman Services in Carlsbad, CA",
  description = "Local handyman for home repairs, installations, and maintenance in Carlsbad, California.",
  canonical,
  noIndex = false,
  ogType = "website",
  ogImage,
} = Astro.props;

const siteUrl = Astro.site?.toString() ?? "https://www.carlsbadfixit.com";
const defaultCanonical = new URL(Astro.url.pathname, siteUrl).toString();
const canonicalUrl = canonical ?? defaultCanonical;
const robots = noIndex ? "noindex,follow" : "index,follow";
const defaultOgImage = new URL(
  "/images/logo/logo-medium.png",
  siteUrl,
).toString();
const ogImageUrl = ogImage ?? defaultOgImage;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={canonicalUrl} />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:site_name" content="Carlsbad Fix It" />
    <meta property="og:locale" content="en_US" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />

    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/logo/logo-small.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="/images/logo/logo-medium.png"
    />
    <link rel="apple-touch-icon" href="/images/logo/logo-large.png" />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-8L6X2ZZ5JH"
      is:inline></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-8L6X2ZZ5JH");
    </script>
    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        if (typeof window.gtag !== "function") return;

        const sendEvent = (name, category, label) => {
          window.gtag("event", name, {
            event_category: category,
            event_label: label,
            page_location: window.location.href,
            page_path: window.location.pathname,
            page_title: document.title,
          });
        };

        // Click events
        document.querySelectorAll("[data-ga-event]").forEach((el) => {
          el.addEventListener("click", () => {
            const name = el.dataset.gaEvent || "custom_click";
            const category = el.dataset.gaCategory || "cta";
            const label = el.dataset.gaLabel || window.location.pathname;
            sendEvent(name, category, label);
          });
        });

        // Form submit events
        document.querySelectorAll("[data-ga-form-event]").forEach((form) => {
          form.addEventListener("submit", () => {
            const name = form.dataset.gaFormEvent || "form_submit";
            const category = form.dataset.gaCategory || "form";
            const label = form.dataset.gaLabel || window.location.pathname;
            sendEvent(name, category, label);
          });
        });
      });
    </script>

    <slot name="head" />

    <script
      src="https://analytics.ahrefs.com/analytics.js"
      data-key="wkBUuhMf8Osy6n8MvgXn6w"
      async
      is:inline></script>
  </head>
  <body class="pb-16 sm:pb-0">
    <SiteHeader />
    <TrustStrip />
    <main
      class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-4 py-8 md:gap-10 md:py-10"
    >
      <slot />
    </main>
    <SiteFooter />
    <MobileStickyCta />
    <!-- GA4 lead + call tracking -->
    <script src="/ga-lead-forms.js" defer is:inline></script>
  </body>
</html>
