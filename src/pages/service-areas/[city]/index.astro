---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import QuickEstimateCard from "../../../components/QuickEstimateCard.astro";
import PageCtaStrip from "../../../components/PageCtaStrip.astro";
import { services } from "../../../data/services";
import { serviceAreas } from "../../../data/service-areas";
import { cityContent } from "../../../data/city-content";
import { getBreadcrumbJsonLd } from "../../../lib/seo";

export function getStaticPaths() {
  return serviceAreas.map((area) => ({
    params: { city: area.slug },
    props: { city: area },
  }));
}

const { city } = Astro.props;

const content = cityContent[city.slug] ?? {};

const intro =
  content.intro ??
  `Local handyman services for homeowners in ${city.label} and nearby neighborhoods. Typical visits combine several small repair or improvement tasks into a tidy service window.`;

const neighborhoods = content.neighborhoods ?? [];
const propertyTypes = content.propertyTypes ?? [];
const popularProjects = content.popularProjects ?? [];

const landlordNote =
  content.landlordNote ??
  "Helpful for small rental portfolios that need occasional drywall repairs, fixture swaps, or honey-do style lists between longer tenancies.";

const businessNote =
  content.businessNote ??
  "Light repairs and small improvement projects for local offices, studios, and storefronts that want a tidy result with minimal disruption.";

const reviewSnippet =
  content.reviewSnippet ?? {
    quote:
      "They handled drywall repairs, a few trim fixes, and a new light in one visit. Everything looked neat and was cleaned up before they left.",
    name: "Sarah M.",
    location: `${city.label}, CA`,
    role: "Homeowner",
  };

const servicesTitle = `Handyman services available in ${city.label}`;
const coverageTitle = `A local option for small home projects in ${city.label}, CA`;

const breadcrumbJsonLd = JSON.stringify(
  getBreadcrumbJsonLd([
    { name: "Home", url: "/" },
    { name: "Service areas", url: "/service-areas/" },
    { name: city.label, url: `/service-areas/${city.slug}/` },
  ]),
);

const title = `Handyman services in ${city.label} | Carlsbad Fix It`;
const description = `Local handyman help for small to medium projects in ${city.label} and nearby North County San Diego communities. Combine several tasks into a single, tidy visit with Carlsbad Fix It.`;
---

<BaseLayout title={title} description={description}>
  <script type="application/ld+json" slot="head">
    {breadcrumbJsonLd}
  </script>

  <section class="rounded-3xl bg-white p-6 shadow-card md:p-8">
    <div class="grid gap-10 lg:grid-cols-[minmax(0,1.5fr)_minmax(0,1.2fr)] lg:items-center">
      <div class="space-y-5">
        <div class="space-y-2">
          <p class="eyebrow text-cf-textMuted">Service area</p>
          <h1 class="text-display font-semibold tracking-tight text-cf-text">
            Handyman services in {city.label}
          </h1>
          <p class="max-w-xl text-body-sm text-cf-textMuted">
            {intro}
          </p>
        </div>

        <ul class="grid gap-3 text-xs text-cf-textMuted sm:grid-cols-2">
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-cf-sand text-[10px] font-semibold text-cf-text">
              ✓
            </span>
            <span>Licensed and insured local handyman serving {city.label} and nearby North County communities.</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-cf-sand text-[10px] font-semibold text-cf-text">
              ✓
            </span>
            <span>Focused on small to medium home projects that fit into clear service windows.</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-cf-sand text-[10px] font-semibold text-cf-text">
              ✓
            </span>
            <span>Tidy job sites with surfaces protected and cleanup before leaving.</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-cf-sand text-[10px] font-semibold text-cf-text">
              ✓
            </span>
            <span>Clear expectations on scope, timing, and pricing before work begins.</span>
          </li>
        </ul>

        <div class="flex flex-wrap items-center gap-3 text-xs">
          <a href="#city-form" class="btn-primary">
            Request an estimate
          </a>
          <a href="tel:18082266681" class="btn-outline">
            Call or text (808) 226-6681
          </a>
        </div>
      </div>

      <aside id="city-form" class="rounded-2xl bg-cf-sandSoft p-5 text-cf-text shadow-cta sm:p-6">
        <QuickEstimateCard
          eyebrow="Get your estimate started"
          title={`Request your free estimate in ${city.label}`}
          body={`Tell us about your project in ${city.label}. Share your location, a short list of tasks, and any helpful photos. You will receive clear next steps, timing, and a no-obligation estimate.`}
          defaultCity={city.label}
        />
      </aside>
    </div>
  </section>

  <section class="mt-8 rounded-3xl bg-cf-sandSoft p-6 md:p-8">
    <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
      <div class="space-y-2">
        <p class="eyebrow text-cf-textMuted">Services in {city.label}</p>
        <h2 class="text-h2 font-semibold text-cf-text">
          {servicesTitle}
        </h2>
        <p class="max-w-2xl text-body-sm text-cf-textMuted">
          Core handyman services focused on the small to medium projects homeowners in {city.label} call about most. You can also combine several tasks into a single visit.
        </p>
      </div>
    </div>

    <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {services.map((service) => (
        <article class="flex h-full flex-col justify-between rounded-2xl bg-white p-5 text-sm text-cf-text shadow-soft">
          <div class="space-y-2">
            <h3 class="text-sm font-semibold text-cf-text">
              {service.name}
            </h3>
            <p class="text-xs text-cf-textMuted">
              {service.shortDescription}
            </p>
          </div>
          <div class="mt-4 flex items-center justify-between text-[11px]">
            <a
              href={`/service-areas/${city.slug}/${service.slug}/`}
              class="btn-primary"
            >
              Learn more
            </a>
            <span class="text-cf-textMuted">
              In {city.label}
            </span>
          </div>
        </article>
      ))}
    </div>
  </section>

  <section class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8">
    <div class="grid gap-8 lg:grid-cols-[minmax(0,1.8fr)_minmax(0,1.4fr)] lg:items-start">
      <div class="space-y-3">
        <p class="eyebrow text-cf-textMuted">Coverage</p>
        <h2 class="text-h2 font-semibold text-cf-text">
          {coverageTitle}
        </h2>
        <p class="text-body-sm text-cf-textMuted">
          Most visits in {city.label} are scheduled to keep travel time reasonable and maximize time spent on actual repair and improvement work. Projects are scoped so they fit into a single visit whenever possible, with larger projects broken into clear phases.
        </p>

        {neighborhoods.length > 0 && (
          <div class="mt-4">
            <p class="text-xs font-semibold uppercase tracking-wide text-cf-textMuted">
              Neighborhoods often served
            </p>
            <div class="mt-2 flex flex-wrap gap-2 text-[11px]">
              {neighborhoods.map((name) => (
                <span class="inline-flex items-center rounded-full bg-cf-sandSoft px-3 py-1 text-cf-text">
                  {name}
                </span>
              ))}
            </div>
          </div>
        )}

        {propertyTypes.length > 0 && (
          <div class="mt-4">
            <p class="text-xs font-semibold uppercase tracking-wide text-cf-textMuted">
              Typical property types
            </p>
            <ul class="mt-2 grid gap-1 text-xs text-cf-textMuted sm:grid-cols-2">
              {propertyTypes.map((type) => (
                <li class="flex gap-2">
                  <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-cf-sand text-[10px] font-semibold text-cf-text">
                    •
                  </span>
                  <span>{type}</span>
                </li>
              ))}
            </ul>
          </div>
        )}
      </div>

      <div class="space-y-4">
        {popularProjects.length > 0 && (
          <section class="rounded-2xl bg-cf-sandSoft p-5">
            <p class="text-xs font-semibold uppercase tracking-wide text-cf-textMuted">
              Popular projects in {city.label}
            </p>
            <div class="mt-3 space-y-3">
              {popularProjects.map((project) => (
                <div class="rounded-2xl bg-white p-4 text-xs text-cf-text shadow-soft">
                  <h3 class="text-sm font-semibold text-cf-text">
                    {project.title}
                  </h3>
                  <p class="mt-1 text-xs text-cf-textMuted">
                    {project.summary}
                  </p>
                </div>
              ))}
            </div>
          </section>
        )}

        <section class="rounded-2xl bg-cf-sandSoft p-5 text-xs text-cf-text">
          <p class="text-xs font-semibold uppercase tracking-wide text-cf-textMuted">
            For small rentals
          </p>
          <p class="mt-2 text-cf-textMuted">
            {landlordNote}
          </p>
        </section>

        <section class="rounded-2xl bg-cf-sandSoft p-5 text-xs text-cf-text">
          <p class="text-xs font-semibold uppercase tracking-wide text-cf-textMuted">
            For local businesses
          </p>
          <p class="mt-2 text-cf-textMuted">
            {businessNote}
          </p>
        </section>

        <section class="rounded-2xl bg-cf-card p-5 text-xs text-cf-text shadow-soft">
          <p class="text-xs font-semibold uppercase tracking-wide text-cf-textMuted">
            What homeowners say in {city.label}
          </p>
          <p class="mt-2 text-sm text-cf-textMuted">
            “{reviewSnippet.quote}”
          </p>
          <p class="mt-3 text-xs text-cf-textMuted">
            {reviewSnippet.name}
            {reviewSnippet.location ? ` · ${reviewSnippet.location}` : ""}
            {reviewSnippet.role ? ` · ${reviewSnippet.role}` : ""}
          </p>
        </section>
      </div>
    </div>
  </section>

  <PageCtaStrip
    eyebrow={`Next steps in ${city.label}`}
    title={`Ready to schedule a handyman visit in ${city.label}?`}
    body={`Share your punch list, preferred timing, and any helpful photos. You will receive clear next steps and a no-obligation estimate for your home in ${city.label}.`}
  />
</BaseLayout>
