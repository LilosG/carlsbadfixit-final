---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { services } from "../../data/services";
import { serviceAreas } from "../../data/service-areas";
import { serviceContent } from "../../data/service-content";
import { getServiceJsonLd, getBreadcrumbJsonLd } from "../../lib/seo";
import QuickEstimateCard from "../../components/QuickEstimateCard.astro";
import PageCtaStrip from "../../components/PageCtaStrip.astro";

export function getStaticPaths() {
  return services.map((service) => ({
    params: { service: service.slug },
    props: { service },
  }));
}

const { service } = Astro.props;

const primaryArea =
  serviceAreas.find((area) => area.primary) ?? serviceAreas[0];

const content = serviceContent[service.slug] ?? {};

const serviceJsonLd = JSON.stringify(
  getServiceJsonLd(service, primaryArea.label),
);

const breadcrumbJsonLd = JSON.stringify(
  getBreadcrumbJsonLd([
    { name: "Home", url: "/" },
    { name: "Services", url: "/services/" },
    { name: service.name, url: `/services/${service.slug}/` },
  ]),
);

const intro =
  content.intro ??
  `${service.shortDescription} Visits are scoped as small to medium projects that fit into a clear service window with tidy work and clear communication.`;

const overviewParagraphs = [
  intro,
  `${service.name} visits are built around a focused punch list so the most important items can be completed safely and efficiently in a single visit whenever possible. Related tasks in the same area of the home are grouped together so more gets done without multiple trips.`,
];

const typicalHeading =
  content.typicalProjectsHeading ??
  `Typical ${service.name.toLowerCase()} projects`;

const typicalIntro =
  content.typicalProjectsIntro ??
  `Examples of ${service.name.toLowerCase()} projects that are a good fit for a handyman visit. The exact scope is tailored to your home, access, and priorities.`;

const typicalColumns =
  content.typicalProjectsColumns && content.typicalProjectsColumns.length > 0
    ? content.typicalProjectsColumns
    : [
        {
          title: service.name,
          items: service.examples ?? [],
        },
      ];

const pricingHeading =
  content.pricingHeading ??
  `How pricing works for ${service.name.toLowerCase()} visits`;

const pricingParagraphs =
  content.pricingParagraphs && content.pricingParagraphs.length > 0
    ? content.pricingParagraphs
    : [
        `Most ${service.name.toLowerCase()} visits are scoped as a minimum service window so there is enough time to complete the work, test everything, and clean up before leaving.`,
        "When your list is larger or spread across several rooms, the visit may be quoted as a half day or broken into clear phases so you always know what is planned.",
        "Photos of the existing conditions are very helpful. When you request an estimate, include close-up photos along with a wider view that shows how the area fits into the rest of the space.",
      ];

const faqItems = content.faq ?? [];

const processSteps = [
  {
    step: "1",
    title: "Share your project list",
    body: `Send your list, location in ${primaryArea.name}, and any helpful photos using the online form or by email.`,
  },
  {
    step: "2",
    title: "Review your estimate and plan",
    body: "You will receive a clear outline of what is included, expected service time, and the earliest available visit.",
  },
  {
    step: "3",
    title: "We complete the work and clean up",
    body: "We arrive within your service window, complete as much as safely possible, and leave your home tidy before heading out.",
  },
];

const reviews = [
  {
    quote:
      "They handled our list of small repairs and fixture swaps in one visit. Everything looked neat and was cleaned up before they left.",
    name: "Sarah M.",
    location: "Carlsbad, CA",
    role: "Homeowner",
  },
  {
    quote:
      "Clear estimate, on-time arrival, and professional work. It was easy to combine a few projects into one service visit.",
    name: "David R.",
    location: "Encinitas, CA",
    role: "Homeowner",
  },
  {
    quote:
      "Reliable help for small repair lists between tenants. Communication is solid and the work is always tidy.",
    name: "Rachel K.",
    location: "Vista, CA",
    role: "Small landlord",
  },
];

const navItems = [
  { id: "overview", label: "Overview" },
  { id: "projects", label: "Typical projects" },
  { id: "pricing", label: "Pricing & scheduling" },
  { id: "process", label: "How it works" },
  { id: "areas", label: "Service areas" },
  { id: "reviews", label: "Reviews" },
  { id: "faq", label: "FAQ" },
];

const title = `${service.name} handyman services in ${primaryArea.label} | Carlsbad Fix It`;

const description = `Local help with ${service.name.toLowerCase()} projects in ${primaryArea.label} and nearby North County communities. Small to medium projects, tidy work, and clear communication from Carlsbad Fix It.`;
---

<BaseLayout title={title} description={description}>
  <script type="application/ld+json" slot="head" is:inline>
    {serviceJsonLd}
  </script>
  <script type="application/ld+json" slot="head" is:inline>
    {breadcrumbJsonLd}
  </script>

  <section class="rounded-3xl bg-gradient-to-br from-cf-accentBlue via-sky-700 to-cf-primary px-6 py-10 text-white shadow-card">
    <div class="pointer-events-none absolute inset-0 -z-10 opacity-25">
      <div class="absolute -left-32 -top-24 h-72 w-72 rounded-full bg-white/15 blur-3xl"></div>
      <div class="absolute bottom-[-6rem] right-[-4rem] h-80 w-80 rounded-full bg-amber-300/25 blur-3xl"></div>
    </div>

    <div class="relative z-10 grid gap-10 lg:grid-cols-[minmax(0,1.5fr)_minmax(0,1.2fr)] lg:items-center">
      <div class="space-y-6">
        <div class="space-y-2">
          <p class="eyebrow text-amber-200">Handyman service for North County homes</p>
          <h1 class="text-display font-semibold tracking-tight text-white">
            {service.name} for North County homes
          </h1>
          <p class="max-w-xl text-sm text-sky-100">
            Clean, code-conscious help with small {service.name.toLowerCase()} projects so your home feels brighter, safer, and easier to use.
          </p>
        </div>

        <ul class="grid gap-3 text-xs text-sky-50 sm:grid-cols-2">
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-amber-300/20 text-[10px] font-semibold text-amber-100">
              ✓
            </span>
            <span>Licensed and insured local handyman based near {primaryArea.label}.</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-amber-300/20 text-[10px] font-semibold text-amber-100">
              ✓
            </span>
            <span>Focused on small to medium projects that fit into clear service windows.</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-amber-300/20 text-[10px] font-semibold text-amber-100">
              ✓
            </span>
            <span>Tidy job sites with surfaces protected and cleanup before leaving.</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-amber-300/20 text-[10px] font-semibold text-amber-100">
              ✓
            </span>
            <span>Clear expectations on timing, scope, and pricing before work begins.</span>
          </li>
        </ul>

        <div class="flex flex-wrap items-center gap-3 text-xs">
          <a href="#service-form" class="btn-primary">
            Request a {service.name.toLowerCase()} visit
          </a>
          <a href="tel:+18082266681" data-ga-event="call_click" data-ga-label="site_phone" class="btn-outline">
            Call or text (808) 226-6681
          </a>
        </div>
      </div>

      <aside id="service-form" class="rounded-2xl bg-white p-5 text-cf-text shadow-cta sm:p-6">
        <QuickEstimateCard
          eyebrow="Quick request"
          title={`Request your ${service.name.toLowerCase()} visit`}
          body={`Share your location, a short list of ${service.name.toLowerCase()} tasks, and any helpful photos. You will receive clear next steps and timing before anything is scheduled.`}
          defaultService={service.name}
          defaultCity={primaryArea.label}
        />
      </aside>
    </div>
  </section>

  <nav class="mt-6 overflow-x-auto">
    <ul class="flex gap-2 text-xs text-cf-textMuted">
      {navItems.map((item) => (
        <li>
          <a
            href={`#${item.id}`}
            class="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-[11px] font-medium text-slate-700 shadow-soft hover:border-sky-300 hover:text-sky-800"
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>
  </nav>

  <section
    id="overview"
    class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8"
  >
    <div class="grid gap-8 md:grid-cols-[minmax(0,1.8fr)_minmax(0,1.3fr)] md:items-start">
      <div class="space-y-3">
        <p class="eyebrow">What we do during a visit</p>
        <h2 class="text-h2 font-semibold text-cf-text">
          {service.name} focused on small to medium projects
        </h2>
        <div class="space-y-3 text-body-sm text-cf-textMuted">
          {overviewParagraphs.map((paragraph) => (
            <p>{paragraph}</p>
          ))}
        </div>
      </div>

      <aside class="space-y-3 rounded-2xl bg-cf-sandSoft p-5 text-sm text-cf-text">
        <p class="text-xs font-semibold uppercase tracking-wide text-sky-700">
          A good fit for this service
        </p>
        <p class="text-sm">
          Smaller, tidy projects that can be completed in a focused visit. The goal is to leave things safe, functional, and ready for daily use.
        </p>
        <ul class="mt-2 space-y-2 text-xs text-cf-textMuted">
          <li>Lists that combine a few related tasks in the same area.</li>
          <li>Updates that improve lighting, comfort, or day-to-day usability.</li>
          <li>Repair work that does not require a full remodel or major trades.</li>
        </ul>
      </aside>
    </div>
  </section>

  <section
    id="projects"
    class="mt-8 rounded-3xl bg-cf-sandSoft p-6 md:p-8"
  >
    <div class="space-y-2">
      <p class="eyebrow">Typical projects</p>
      <h2 class="text-h2 font-semibold text-cf-text">
        {typicalHeading}
      </h2>
      <p class="text-body-sm text-cf-textMuted">{typicalIntro}</p>
    </div>

    <div class="mt-6 grid gap-6 md:grid-cols-2">
      {typicalColumns.map((column) => (
        <div class="rounded-2xl bg-white/80 p-5 shadow-soft">
          <h3 class="text-sm font-semibold text-cf-text">
            {column.title}
          </h3>
          <ul class="mt-3 space-y-2 text-xs text-cf-textMuted">
            {column.items.map((item) => (
              <li class="flex gap-2">
                <span class="mt-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-cf-sand text-[10px] font-semibold text-cf-text">
                  •
                </span>
                <span>{item}</span>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </div>
  </section>

  <section
    id="pricing"
    class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8"
  >
    <div class="grid gap-8 md:grid-cols-[minmax(0,1.8fr)_minmax(0,1.3fr)] md:items-start">
      <div class="space-y-3">
        <p class="eyebrow">Pricing and scheduling</p>
        <h2 class="text-h2 font-semibold text-cf-text">
          {pricingHeading}
        </h2>
        <div class="space-y-3 text-body-sm text-cf-textMuted">
          {pricingParagraphs.map((paragraph) => (
            <p>{paragraph}</p>
          ))}
        </div>
      </div>

      <aside class="space-y-3 rounded-2xl bg-cf-sandSoft p-5 text-xs text-cf-textMuted">
        <p class="text-xs font-semibold uppercase tracking-wide text-sky-700">
          When we will refer you out
        </p>
        <p>
          Larger projects, significant code issues, or work that requires permits and multiple trades are usually better handled by a full-service contractor.
        </p>
        <ul class="mt-2 space-y-2">
          <li>Major structural changes or full-room remodels.</li>
          <li>Emergency repairs such as active leaks or urgent electrical issues.</li>
          <li>Projects that require specialized equipment or large crews.</li>
        </ul>
      </aside>
    </div>
  </section>

  <section
    id="process"
    class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8"
  >
    <div class="space-y-2">
      <p class="eyebrow">How it works</p>
      <h2 class="text-h2 font-semibold text-cf-text">
        A simple 3-step process for {service.name.toLowerCase()} visits
      </h2>
      <p class="text-body-sm text-cf-textMuted">
        Clear communication and a tidy result from first message through the final walkthrough.
      </p>
    </div>

    <div class="mt-6 grid gap-6 md:grid-cols-3">
      {processSteps.map((step) => (
        <div class="group h-full rounded-2xl border border-cf-borderSubtle bg-gradient-to-b from-white to-cf-card/80 p-5 shadow-soft transition-transform duration-150 group-hover:-translate-y-0.5 group-hover:shadow-card">
          <div class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-sky-700">
            <span class="flex h-7 w-7 items-center justify-center rounded-full bg-sky-100 text-[11px] text-sky-700 shadow-inner">
              {step.step}
            </span>
            <span>Step {step.step}</span>
          </div>
          <h3 class="mt-3 text-sm font-semibold text-cf-text">
            {step.title}
          </h3>
          <p class="mt-2 text-xs text-cf-textMuted">
            {step.body}
          </p>
        </div>
      ))}
    </div>
  </section>

  <section
    id="areas"
    class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8"
  >
    <div class="space-y-3">
      <p class="eyebrow">Service areas</p>
      <h2 class="text-h2 font-semibold text-cf-text">
        Where we offer {service.name.toLowerCase()} services
      </h2>
      <p class="text-body-sm text-cf-textMuted">
        Carlsbad Fix It is based in {primaryArea.label} with select availability in nearby North County San Diego communities. Availability in each area depends on schedule and project scope.
      </p>
    </div>

    <div class="mt-4 flex flex-wrap gap-2 text-xs">
      {serviceAreas.map((area) => (
        <a
          href={`/service-areas/${area.slug}/${service.slug}/`}
          class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-[11px] font-semibold text-slate-700 shadow-soft hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800"
        >
          {service.name} in {area.label}
        </a>
      ))}
    </div>
  </section>

  <section
    id="reviews"
    class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8"
  >
    <div class="space-y-2">
      <p class="eyebrow">What homeowners say</p>
      <h2 class="text-h2 font-semibold text-cf-text">
        Tidy, professional {service.name.toLowerCase()} visits
      </h2>
      <p class="text-body-sm text-cf-textMuted">
        These short quotes are representative of the experience Carlsbad Fix It aims to deliver on every visit.
      </p>
    </div>

    <div class="mt-6 grid gap-6 md:grid-cols-3">
      {reviews.map((review) => (
        <figure class="flex h-full flex-col justify-between rounded-2xl bg-cf-card p-5 shadow-soft">
          <blockquote class="text-sm text-cf-textMuted">
            “{review.quote}”
          </blockquote>
          <figcaption class="mt-4 text-xs">
            <p class="font-semibold text-cf-text">{review.name}</p>
            <p class="text-cf-textMuted">
              {review.location}
              {review.role ? ` · ${review.role}` : ""}
            </p>
          </figcaption>
        </figure>
      ))}
    </div>
  </section>

  {faqItems.length > 0 && (
    <section
      id="faq"
      class="mt-8 rounded-3xl bg-white p-6 shadow-soft md:p-8"
    >
      <div class="space-y-2">
        <p class="eyebrow">Questions from homeowners</p>
        <h2 class="text-h2 font-semibold text-cf-text">
          Frequently asked questions about {service.name.toLowerCase()} visits
        </h2>
        <p class="text-body-sm text-cf-textMuted">
          A few common questions that come up when homeowners request{" "}
          {service.name.toLowerCase()} help. If you do not see your question
          here, you can always add it to your estimate request.
        </p>
      </div>

      <div class="mt-4 space-y-3">
        {faqItems.map((item) => (
          <details class="card">
            <summary class="cursor-pointer text-sm font-semibold text-cf-text">
              {item.question}
            </summary>
            <p class="mt-2 text-sm text-cf-textMuted">
              {item.answer}
            </p>
          </details>
        ))}
      </div>
    </section>
  )}

  <PageCtaStrip
    eyebrow="Next steps"
    title={`Ready to schedule ${service.name.toLowerCase()} help?`}
    body="Share your punch list, preferred timing, and any helpful photos. You will receive clear next steps and a no-obligation estimate."
  />
</BaseLayout>
